{% extends 'base.html' %}

{% block title %}{{ project.title }} - Amaanitvam Foundation{% endblock %}
{% block meta_description %}{{ project.short_description }}{% endblock %}

{% block content %}
<!-- Hero Section with Cover Image -->
<section class="relative py-32 bg-stc-black overflow-hidden">
    <!-- Background Image -->
    <div class="absolute inset-0">
        {% if project.cover_image %}
        <img src="{{ project.cover_image.url }}" alt="{{ project.title }}" class="w-full h-full object-cover">
        {% else %}
        <div class="w-full h-full bg-gradient-to-br from-stc-red-500 to-stc-black"></div>
        {% endif %}
        <div class="absolute inset-0 bg-black/70"></div>
    </div>
    <div class="relative max-w-4xl mx-auto px-4 text-center">
        <!-- Status Badge -->
        <span class="inline-block px-4 py-1 text-sm font-bold uppercase tracking-wide rounded mb-4
            {% if project.status == 'ongoing' %}bg-green-500 text-white
            {% elif project.status == 'completed' %}bg-blue-500 text-white
            {% else %}bg-yellow-500 text-black{% endif %}">
            {{ project.get_status_display }}
        </span>

        <h1 class="text-4xl md:text-5xl lg:text-6xl font-black text-white mb-4 font-display">
            {{ project.title }}
        </h1>

        {% if project.location %}
        <p class="text-stc-red-400 font-semibold text-lg mb-4">
            üìç {{ project.location }}
        </p>
        {% endif %}

        <p class="text-xl text-gray-300 max-w-2xl mx-auto">
            {{ project.short_description }}
        </p>

        {% if project.beneficiaries_count > 0 %}
        <div class="mt-8">
            <span class="text-4xl font-black text-stc-red-500">{{ project.beneficiaries_count }}+</span>
            <span class="text-white ml-2">Children Impacted</span>
        </div>
        {% endif %}
    </div>
</section>

<!-- Video Section (if video exists) -->
{% if project.video_url %}
<section class="py-12 bg-stc-black">
    <div class="max-w-4xl mx-auto px-4">
        <div class="aspect-video rounded-lg overflow-hidden shadow-2xl">
            {% if 'youtube.com' in project.video_url or 'youtu.be' in project.video_url %}
            <iframe
                src="{% if 'youtube.com/watch' in project.video_url %}https://www.youtube.com/embed/{{ project.video_url|cut:'https://www.youtube.com/watch?v=' }}{% elif 'youtu.be' in project.video_url %}https://www.youtube.com/embed/{{ project.video_url|cut:'https://youtu.be/' }}{% endif %}"
                class="w-full h-full" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen>
            </iframe>
            {% else %}
            <a href="{{ project.video_url }}" target="_blank"
                class="block w-full h-full bg-gray-900 flex items-center justify-center hover:bg-gray-800 transition-colors">
                <div class="text-center">
                    <span class="text-6xl">‚ñ∂</span>
                    <p class="text-white mt-4">Watch Video</p>
                </div>
            </a>
            {% endif %}
        </div>
    </div>
</section>
{% endif %}

<!-- Full Description -->
<section class="py-16 bg-white">
    <div class="max-w-4xl mx-auto px-4">
        <h2 class="text-2xl font-bold text-stc-black mb-6 font-display uppercase">About This Project</h2>
        <div class="prose prose-lg max-w-none text-gray-600 leading-relaxed">
            {{ project.full_description|safe }}
        </div>
    </div>
</section>

<!-- Image Gallery -->
{% if images %}
<section class="py-16 bg-stc-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-10">
            <h2 class="text-3xl font-bold text-stc-black font-display uppercase">Project Gallery</h2>
            <p class="text-gray-600 mt-2">{{ images.count }} photos from this project</p>
        </div>

        <!-- Gallery Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for image in images %}
            <div class="group relative overflow-hidden rounded-lg shadow-lg aspect-[4/3] cursor-pointer"
                onclick="openLightbox('{{ image.image.url }}', '{{ image.caption }}')">
                <img src="{{ image.image.url }}" alt="{{ image.caption }}"
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                <div
                    class="absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors flex items-center justify-center">
                    <span class="text-white text-4xl opacity-0 group-hover:opacity-100 transition-opacity">üîç</span>
                </div>
                {% if image.caption %}
                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4">
                    <p class="text-white text-sm">{{ image.caption }}</p>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Project Updates -->
{% if updates %}
<section class="py-16 bg-white">
    <div class="max-w-4xl mx-auto px-4">
        <h2 class="text-2xl font-bold text-stc-black mb-8 font-display uppercase">Latest Updates</h2>

        <div class="space-y-6">
            {% for update in updates %}
            <div class="border-l-4 border-stc-red-500 pl-6 py-4 bg-stc-gray-50 rounded-r-lg">
                <div class="flex items-center gap-3 mb-2">
                    <span class="text-sm text-gray-500 font-medium">{{ update.date|date:"F d, Y" }}</span>
                </div>
                <h3 class="text-xl font-bold text-stc-black mb-2">{{ update.title }}</h3>
                <div class="text-gray-600">
                    {{ update.content|safe }}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Back to What We Do -->
<section class="py-12 bg-stc-red-500">
    <div class="max-w-4xl mx-auto px-4 text-center">
        <a href="{% url 'what_we_do' %}"
            class="inline-block bg-white hover:bg-gray-100 text-stc-red-500 font-bold py-3 px-8 transition-colors uppercase tracking-wide">
            ‚Üê Back to All Projects
        </a>
    </div>
</section>

<!-- Lightbox Modal -->
<div id="lightbox" class="fixed inset-0 bg-black/90 z-50 hidden items-center justify-center p-4"
    onclick="closeLightbox()">
    <button onclick="closeLightbox()"
        class="absolute top-4 right-4 text-white text-4xl hover:text-stc-red-500 transition-colors">&times;</button>
    <div class="max-w-5xl max-h-[90vh]" onclick="event.stopPropagation()">
        <img id="lightbox-img" src="" alt="" class="max-w-full max-h-[85vh] rounded-lg shadow-2xl">
        <p id="lightbox-caption" class="text-white text-center mt-4"></p>
    </div>
</div>

<script>
    function openLightbox(src, caption) {
        document.getElementById('lightbox-img').src = src;
        document.getElementById('lightbox-caption').textContent = caption || '';
        document.getElementById('lightbox').classList.remove('hidden');
        document.getElementById('lightbox').classList.add('flex');
        document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
        document.getElementById('lightbox').classList.add('hidden');
        document.getElementById('lightbox').classList.remove('flex');
        document.body.style.overflow = '';
    }

    // Close on escape key
    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
            closeLightbox();
        }
    });
</script>
{% endblock %}